<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pizzas y Fracciones - Actividad 1 y 2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #ffeaa7 0, #fab1a0 30%, #81ecec 100%);
      margin: 0;
      padding: 20px 12px 40px;
      color: #2d3436;
    }

    h1 {
      text-align: center;
      margin-bottom: 5px;
      font-size: 2rem;
      letter-spacing: 0.5px;
    }

    .subtitulo {
      text-align: center;
      font-size: 0.95rem;
      color: #2d3436;
      margin-bottom: 20px;
    }

    .subtitulo strong {
      color: #d63031;
    }

    .juego {
      max-width: 960px;
      margin: 0 auto;
      background: rgba(255,255,255,0.97);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      padding: 22px 22px 18px;
      border: 3px solid rgba(255,255,255,0.7);
      position: relative;
      overflow: hidden;
    }

    .juego::before {
      content: "üçï";
      position: absolute;
      font-size: 2.2rem;
      opacity: 0.18;
      top: -6px;
      right: 16px;
      transform: rotate(10deg);
    }

    .barra-superior-juego {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .niveles {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .nivel-btn {
      padding: 8px 16px;
      border-radius: 999px;
      border: 2px solid #ffeaa7;
      background: #fff;
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      position: relative;
    }

    .nivel-btn span.badge {
      background: #fdcb6e;
      border-radius: 999px;
      padding: 2px 6px;
      font-size: 0.75rem;
    }

    .nivel-btn.activo {
      background: #fdcb6e;
      border-color: #e17055;
      color: #2d3436;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
      transform: translateY(-1px);
    }

    /* Subniveles Actividad 2 */
    .subniveles {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 10px;
    }

    .subnivel-btn {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid #dfe6e9;
      background: #ffffff;
      cursor: pointer;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .subnivel-btn.activo {
      background: #ffeaa7;
      border-color: #e17055;
      font-weight: 600;
    }

    /* ---- Actividad 1 ---- */

    #actividad1 { margin-top: 6px; }

    .zona-actividad1 {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      align-items: center;
    }

    .fraccion-box-actividad1 {
      display: flex;
      flex-direction: column;
      align-items: center;
      border-right: 3px dashed #e67e22;
      padding-right: 20px;
      min-width: 230px;
      text-align: center;
    }

    .fraccion-box-actividad1 h2 {
      margin: 4px 0 8px;
      font-size: 1rem;
    }

    .fraccion-simple {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .fraccion-simple input {
      width: 70px;
      font-size: 1.5rem;
      padding: 5px;
      text-align: center;
      border-radius: 10px;
      border: 2px solid #e67e22;
    }

    .fraccion-simple .linea {
      width: 60px;
      height: 4px;
      background: #d35400;
      margin: 4px 0;
    }

    .boton {
      padding: 9px 16px;
      font-size: 0.95rem;
      background: #ffb067;
      border: 2px solid #d35400;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: bold;
      transition: 0.2s;
    }
    .boton:hover {
      background: #ffcb91;
      transform: scale(1.05);
    }

    .pizzas-actividad1 {
      flex: 1;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: flex-start;
      min-height: 170px;
    }

    .pizza-card {
      width: 150px;
      text-align: center;
    }

    .pizza-svg {
      width: 140px;
      height: 140px;
      margin: 0 auto;
    }

    /* ---- Actividad 2 ---- */

    #actividad2 { margin-top: 6px; }

    .historia {
      background: #f7f8ff;
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 0.95rem;
      margin-bottom: 16px;
      border: 1px dashed #b2bec3;
      position: relative;
    }

    .historia::before {
      content: "Historia";
      position: absolute;
      top: -11px;
      left: 14px;
      font-size: 0.7rem;
      background: #6c5ce7;
      color: #fff;
      padding: 2px 8px;
      border-radius: 999px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .historia strong {
      color: #0984e3;
    }

    .zona-fracciones {
      display: flex;
      gap: 18px;
      flex-wrap: wrap;
      margin-bottom: 8px;
      justify-content: center;
    }

    .carta-fraccion {
      flex: 1 1 270px;
      max-width: 320px;
      background: #ffffff;
      border-radius: 16px;
      padding: 10px 12px 12px;
      border: 2px solid #ffeaa7;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
      position: relative;
    }

    .carta-fraccion h3 {
      margin-top: 6px;
      font-size: 1rem;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .cinta-nombre {
      position: absolute;
      top: -12px;
      right: 12px;
      background: #fd79a8;
      color: #fff;
      padding: 2px 8px;
      font-size: 0.7rem;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .cinta-nombre.azul {
      background: #74b9ff;
    }

    .nombre-icono {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      color: #fff;
    }

    .nombre-icono.luna {
      background: linear-gradient(135deg, #fd79a8, #ffeaa7);
    }

    .nombre-icono.max {
      background: linear-gradient(135deg, #74b9ff, #a29bfe);
    }

    .fraccion-grande {
      margin-bottom: 6px;
      font-size: 1.1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .fraccion-grande span {
      display: block;
      min-width: 40px;
      text-align: center;
    }

    .linea-fraccion {
      border-top: 2px solid #2d3436;
      width: 40px;
      margin: 2px 0;
    }

    .redonda {
      width: 150px;
      height: 150px;
      margin: 4px 0 6px;
    }

    .nota-pequena {
      font-size: 0.8rem;
      color: #636e72;
      margin-top: 4px;
    }

    .panel-respuesta {
      background: #fffaf3;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px dashed #e17055;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }

    .fraccion-respuesta {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      margin: 6px 0;
    }

    .fraccion-respuesta input {
      width: 70px;
      font-size: 1.1rem;
      padding: 4px;
      text-align: center;
      border-radius: 8px;
      border: 1px solid #e17055;
    }

    .panel-verificacion {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-top: 8px;
    }

    .pizzas-respuesta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      min-height: 150px;
    }

    .pizza-respuesta-card {
      width: 140px;
      text-align: center;
    }

    .pizza-respuesta-svg {
      width: 130px;
      height: 130px;
      margin: 0 auto 4px;
    }

    #feedbackRespuesta {
      font-size: 0.85rem;
      min-width: 180px;
    }

    .respuesta-bien {
      color: #27ae60;
      font-weight: 600;
    }

    .respuesta-mal {
      color: #c0392b;
      font-weight: 600;
    }

    .btn-mini {
      padding: 6px 10px;
      font-size: 0.85rem;
      border-radius: 999px;
      border: 1px solid #fab1a0;
      background: #ffeaa7;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-mini:hover {
      background: #ffd1a6;
    }

    .panel-corte {
      background: #fffaf3;
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px dashed #e17055;
      font-size: 0.85rem;
      margin-top: 6px;
      width: 100%;
    }

    .panel-corte input {
      width: 60px;
      padding: 3px;
      text-align: center;
      border-radius: 6px;
      border: 1px solid #dcdde1;
      margin-right: 4px;
    }

    .mensaje {
      margin-top: 8px;
      background: #fff8e6;
      border-radius: 12px;
      padding: 9px 11px;
      font-size: 0.9rem;
      border: 1px solid #ffd79a;
      position: relative;
    }

    .mensaje::before {
      content: "üí°";
      position: absolute;
      left: 8px;
      top: 6px;
      font-size: 1rem;
    }

    .mensaje.ok {
      background: #e6fff3;
      border-color: #8cffc2;
    }

    .mensaje.ok::before {
      content: "‚úÖ";
    }

    .mensaje-texto {
      padding-left: 24px;
    }

    footer {
      text-align: center;
      margin-top: 14px;
    }
    .autor {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 999px;
      background: rgba(255,255,255,0.95);
      box-shadow: 0 3px 10px rgba(0,0,0,0.15);
      font-size: 0.85rem;
      font-weight: 700;
      color: #d63031;
      border: 2px solid #ff7675;
    }

    @media (max-width: 700px) {
      body {
        padding: 12px 8px 28px;
      }
      .juego {
        padding: 16px 14px;
      }
      .zona-actividad1 {
        flex-direction: column;
      }
      .fraccion-box-actividad1 {
        border-right: none;
        border-bottom: 3px dashed #e67e22;
        padding-right: 0;
        padding-bottom: 10px;
      }
      .zona-fracciones {
        flex-direction: column;
        align-items: center;
      }
      .carta-fraccion {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>üçï Pizzas y Fracciones</h1>
  <div class="subtitulo">
    <strong>Actividad 1:</strong> ¬øEn cu√°ntos trozos est√° cortada la pizza y cu√°ntos trozos tenemos?  
    <strong>Actividad 2:</strong> ¬øcu√°nta pizza les queda en total?
  </div>

  <div class="juego">
    <!-- Barra superior -->
    <div class="barra-superior-juego">
      <div class="niveles">
        <button class="nivel-btn activo" data-nivel="0">
          <span class="badge">Actividad 1</span>
        </button>
        <button class="nivel-btn" data-nivel="1">
          <span class="badge">Actividad 2</span>
        </button>
      </div>
    </div>

    <!-- ACTIVIDAD 1 -->
    <div id="actividad1">
      <div class="zona-actividad1">
        <div class="fraccion-box-actividad1">
          <h2>¬øEn cu√°ntos trozos est√° cortada la pizza<br>y cu√°ntos trozos tenemos?</h2>
          <div class="fraccion-simple">
            <input id="numA1" type="number" min="0" value="5">
            <div class="linea"></div>
            <input id="denA1" type="number" min="1" value="7">
          </div>
          <button class="boton" id="btnMostrarA1">Mostrar</button>
        </div>
        <div id="pizzasActividad1" class="pizzas-actividad1"></div>
      </div>
    </div>

    <!-- ACTIVIDAD 2 -->
    <div id="actividad2" style="display:none;">

      <!-- Subactividades A, B, C -->
      <div class="subniveles">
        <button class="subnivel-btn activo" data-escenario="A">A)</button>
        <button class="subnivel-btn" data-escenario="B">B)</button>
        <button class="subnivel-btn" data-escenario="C">C)</button>
      </div>

      <div id="historia" class="historia"></div>

      <div class="zona-fracciones">
        <div class="carta-fraccion">
          <div class="cinta-nombre">Luna</div>
          <h3><span class="nombre-icono luna">üåô</span>Pizza de Luna</h3>
          <div class="fraccion-grande">
            <span id="n1"></span>
            <div class="linea-fraccion"></div>
            <span id="d1"></span>
          </div>
          <div id="redonda1" class="redonda"></div>
          <button id="btnCortarLuna" class="btn-mini" style="display:none;">
            üç¥ Cortar pizza de Luna
          </button>
          <div id="panelCorteLuna" class="panel-corte" style="display:none;">
            <div>¬øEn cu√°ntos pedazos deseas cortar cada trozo? üç¥</div>
            <div>
              <input type="number" id="inputFactorLuna" min="1" max="10" placeholder="2, 3, 4...">
              <button id="btnAplicarCorteLuna" class="btn-mini">Aplicar corte</button>
            </div>
            <div id="mensajeCorteLuna" class="nota-pequena" style="color:#c0392b;"></div>
          </div>
          <button id="btnResetLuna" class="btn-mini" style="display:none; margin-top:4px;">
            üîÑ Volver al corte original
          </button>
        </div>

        <div class="carta-fraccion">
          <div class="cinta-nombre azul">Max</div>
          <h3><span class="nombre-icono max">‚≠ê</span>Pizza de Max</h3>
          <div class="fraccion-grande">
            <span id="n2"></span>
            <div class="linea-fraccion"></div>
            <span id="d2"></span>
          </div>
          <div id="redonda2" class="redonda"></div>
          <button id="btnCortarMax" class="btn-mini" style="display:none;">
            üç¥ Cortar pizza de Max
          </button>
          <div id="panelCorteMax" class="panel-corte" style="display:none;">
            <div>¬øEn cu√°ntos pedazos deseas cortar cada trozo? üç¥</div>
            <div>
              <input type="number" id="inputFactorMax" min="1" max="10" placeholder="2, 3, 4...">
              <button id="btnAplicarCorteMax" class="btn-mini">Aplicar corte</button>
            </div>
            <div id="mensajeCorteMax" class="nota-pequena" style="color:#c0392b;"></div>
          </div>
          <button id="btnResetMax" class="btn-mini" style="display:none; margin-top:4px;">
            üîÑ Volver al corte original
          </button>
        </div>
      </div>

      <!-- Pregunta: ¬øcu√°nta pizza qued√≥? -->
      <div class="panel-respuesta">
        <div><strong>¬øCu√°nta pizza qued√≥ en total entre Luna y Max?</strong></div>
        <div class="fraccion-respuesta">
          <input id="respNum" type="number" min="0" placeholder="numerador">
          <div class="linea" style="width:60px;height:3px;background:#2d3436;margin:3px 0;"></div>
          <input id="respDen" type="number" min="1" placeholder="denominador">
        </div>
        <button class="boton" id="btnVerificar">Verificar</button>

        <div class="panel-verificacion">
          <div id="pizzasRespuesta" class="pizzas-respuesta"></div>
          <div id="feedbackRespuesta" class="nota-pequena"></div>
        </div>
      </div>

      <div id="mensaje" class="mensaje" style="display:none;">
        <div class="mensaje-texto" id="mensajeTexto"></div>
      </div>
    </div>
  </div>

  <footer>
    <div class="autor">¬© Nicol√°s Alarc√≥n-Relmucao</div>
  </footer>

  <script>
    // ---------- Utilidades ----------
    function mcd(a,b){a=Math.abs(a);b=Math.abs(b);while(b){const t=b;b=a%b;a=t;}return a||1;}
    function mcm(a,b){return (a*b)/mcd(a,b);}

    // ---------- Pizza sobre tabla de madera, con cortes visibles ----------
    function crearPizzaConSalame(pintados, total) {
      const ns = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(ns, "svg");
      svg.setAttribute("viewBox", "-1.3 -1.3 2.6 2.6");

      // Tabla de madera
      const tabla = document.createElementNS(ns, "circle");
      tabla.setAttribute("cx", 0);
      tabla.setAttribute("cy", 0);
      tabla.setAttribute("r", 1.2);
      tabla.setAttribute("fill", "#c49a6c");
      svg.appendChild(tabla);

      const bordeTabla = document.createElementNS(ns, "circle");
      bordeTabla.setAttribute("cx", 0);
      bordeTabla.setAttribute("cy", 0);
      bordeTabla.setAttribute("r", 1.23);
      bordeTabla.setAttribute("fill", "none");
      bordeTabla.setAttribute("stroke", "#8e6b3c");
      bordeTabla.setAttribute("stroke-width", "0.06");
      svg.appendChild(bordeTabla);

      const colorQueso = "#ffd86b";
      const colorBorde = "#d35400";
      const colorSalame = "#c0392b";

      const rPizza = 1.0;

      // Para cada trozo, dibujar un sector: si est√°, queso; si falta, tabla
      for (let i = 0; i < total; i++) {
        const angInicio = -Math.PI/2 + (2*Math.PI*i)/total;
        const angFin = -Math.PI/2 + (2*Math.PI*(i+1))/total;
        const largeArcFlag = (angFin - angInicio) > Math.PI ? 1 : 0;

        const x1 = rPizza * Math.cos(angInicio);
        const y1 = rPizza * Math.sin(angInicio);
        const x2 = rPizza * Math.cos(angFin);
        const y2 = rPizza * Math.sin(angFin);

        const porcion = document.createElementNS(ns, "path");
        const dAttr = [
          "M 0 0",
          "L", x1, y1,
          "A", rPizza, rPizza, 0, largeArcFlag, 1, x2, y2,
          "Z"
        ].join(" ");
        porcion.setAttribute("d", dAttr);
        porcion.setAttribute("fill", i < pintados ? colorQueso : "#c49a6c");
        porcion.setAttribute("stroke", "#fdf1c7");
        porcion.setAttribute("stroke-width", "0.02");
        svg.appendChild(porcion);

        // Topping solo en las porciones presentes
        if (i < pintados) {
          const angMedio = (angInicio + angFin) / 2;
          const rPep = 0.6 * rPizza;
          const cx = rPep * Math.cos(angMedio);
          const cy = rPep * Math.sin(angMedio);

          const salame = document.createElementNS(ns, "circle");
          salame.setAttribute("cx", cx);
          salame.setAttribute("cy", cy);
          salame.setAttribute("r", 0.18);
          salame.setAttribute("fill", colorSalame);
          salame.setAttribute("stroke", "#7f2620");
          salame.setAttribute("stroke-width", "0.03");
          svg.appendChild(salame);
        }
      }

      // Borde de la pizza (si hay al menos un trozo)
      if (pintados > 0) {
        const bordePizza = document.createElementNS(ns, "circle");
        bordePizza.setAttribute("cx", 0);
        bordePizza.setAttribute("cy", 0);
        bordePizza.setAttribute("r", rPizza);
        bordePizza.setAttribute("fill", "none");
        bordePizza.setAttribute("stroke", colorBorde);
        bordePizza.setAttribute("stroke-width", "0.08");
        svg.appendChild(bordePizza);
      }

      return svg;
    }

    // ---------- ACTIVIDAD 1 ----------
    const numA1 = document.getElementById('numA1');
    const denA1 = document.getElementById('denA1');
    const btnMostrarA1 = document.getElementById('btnMostrarA1');
    const pizzasActividad1 = document.getElementById('pizzasActividad1');

    function dibujarActividad1() {
      pizzasActividad1.innerHTML = "";
      const n = parseInt(numA1.value, 10);
      const d = parseInt(denA1.value, 10);
      if (isNaN(n) || isNaN(d) || d <= 0 || n < 0) return;

      const completas = Math.floor(n / d);
      const resto = n % d;
      const totalPizzas = completas + (resto > 0 ? 1 : 0);
      if (totalPizzas === 0) return;

      for (let i = 0; i < totalPizzas; i++) {
        const card = document.createElement('div');
        card.className = 'pizza-card';
        const svgWrap = document.createElement('div');
        svgWrap.className = 'pizza-svg';

        const trozos = (i < completas) ? d : resto;
        svgWrap.appendChild(crearPizzaConSalame(trozos, d));
        card.appendChild(svgWrap);
        pizzasActividad1.appendChild(card);
      }
    }

    btnMostrarA1.addEventListener('click', dibujarActividad1);

    // ---------- ACTIVIDAD 2 ----------

    const actividad1Div = document.getElementById('actividad1');
    const actividad2Div = document.getElementById('actividad2');
    const botonesNivel = document.querySelectorAll('.nivel-btn');

    const historiaDiv = document.getElementById('historia');
    const n1Span = document.getElementById('n1');
    const d1Span = document.getElementById('d1');
    const n2Span = document.getElementById('n2');
    const d2Span = document.getElementById('d2');
    const redonda1 = document.getElementById('redonda1');
    const redonda2 = document.getElementById('redonda2');

    const respNum = document.getElementById('respNum');
    const respDen = document.getElementById('respDen');
    const btnVerificar = document.getElementById('btnVerificar');
    const pizzasRespuesta = document.getElementById('pizzasRespuesta');
    const feedbackRespuesta = document.getElementById('feedbackRespuesta');

    const btnCortarLuna = document.getElementById('btnCortarLuna');
    const btnCortarMax = document.getElementById('btnCortarMax');
    const panelCorteLuna = document.getElementById('panelCorteLuna');
    const panelCorteMax = document.getElementById('panelCorteMax');
    const inputFactorLuna = document.getElementById('inputFactorLuna');
    const inputFactorMax = document.getElementById('inputFactorMax');
    const btnAplicarCorteLuna = document.getElementById('btnAplicarCorteLuna');
    const btnAplicarCorteMax = document.getElementById('btnAplicarCorteMax');
    const mensajeCorteLuna = document.getElementById('mensajeCorteLuna');
    const mensajeCorteMax = document.getElementById('mensajeCorteMax');

    const btnResetLuna = document.getElementById('btnResetLuna');
    const btnResetMax = document.getElementById('btnResetMax');

    const mensajeDiv = document.getElementById('mensaje');
    const mensajeTextoDiv = document.getElementById('mensajeTexto');

    const subnivelBtns = document.querySelectorAll('.subnivel-btn');

    // Escenarios de la Actividad 2:
    const escenarios = {
      A: { n1:2, d1:8, n2:3, d2:8 }, // 2/8 y 3/8
      B: { n1:1, d1:6, n2:1, d2:3 }, // 1/6 y 1/3
      C: { n1:1, d1:2, n2:1, d2:3 }  // 1/2 y 1/3
    };

    let escenarioActual = 'A';
    let estadoAct2 = { ...escenarios[escenarioActual] };

    function dibujarPizzaAct2() {
      const {n1,d1,n2,d2} = estadoAct2;
      n1Span.textContent = n1;
      d1Span.textContent = d1;
      n2Span.textContent = n2;
      d2Span.textContent = d2;

      redonda1.innerHTML = "";
      redonda1.appendChild(crearPizzaConSalame(n1,d1));
      redonda2.innerHTML = "";
      redonda2.appendChild(crearPizzaConSalame(n2,d2));
    }

    function sumaActualSimplificada() {
      const {n1,d1,n2,d2} = estadoAct2;
      const l = mcm(d1,d2);
      let num = n1 * (l/d1) + n2 * (l/d2);
      let den = l;
      const g = mcd(num,den);
      return { num: num/g, den: den/g };
    }

    function textoHistoriaParaEscenario(id) {
      const esc = escenarios[id];
      return `
        Luna y Max pidieron <strong>una pizza individual para cada uno</strong>.<br>
        Comieron una parte de sus pizzas y les sobr√≥:<br>
        &bull; A Luna le sobr√≥ <strong>${esc.n1}/${esc.d1}</strong> de su pizza.<br>
        &bull; A Max le sobr√≥ <strong>${esc.n2}/${esc.d2}</strong> de su pizza.<br><br>
        Ahora quieren juntar lo que les queda y se preguntan:<br>
        <strong>¬øcu√°nta pizza qued√≥ en total?</strong>
      `;
    }

    function renderActividad2() {
      historiaDiv.innerHTML = textoHistoriaParaEscenario(escenarioActual);

      dibujarPizzaAct2();

      pizzasRespuesta.innerHTML = "";
      feedbackRespuesta.textContent = "";
      feedbackRespuesta.className = "nota-pequena";

      mensajeDiv.style.display = 'none';
      mensajeDiv.classList.remove('ok');
      mensajeTextoDiv.textContent = "";

      respNum.value = "";
      respDen.value = "";

      // Ocultar paneles de corte y botones de corte/reset
      btnCortarLuna.style.display = 'none';
      btnCortarMax.style.display = 'none';
      panelCorteLuna.style.display = 'none';
      panelCorteMax.style.display = 'none';
      mensajeCorteLuna.textContent = "";
      mensajeCorteMax.textContent = "";
      inputFactorLuna.value = "";
      inputFactorMax.value = "";
      btnResetLuna.style.display = 'none';
      btnResetMax.style.display = 'none';
    }

    function cambiarEscenario(nuevo) {
      escenarioActual = nuevo;
      subnivelBtns.forEach(b => {
        b.classList.toggle('activo', b.getAttribute('data-escenario') === nuevo);
      });
      estadoAct2 = { ...escenarios[escenarioActual] };
      renderActividad2();
    }

    // Navegaci√≥n entre actividades
    botonesNivel.forEach(btn => {
      btn.addEventListener('click', () => {
        botonesNivel.forEach(b => b.classList.remove('activo'));
        btn.classList.add('activo');
        const nivel = parseInt(btn.getAttribute('data-nivel'), 10);
                if (nivel === 0) {
          actividad1Div.style.display = 'block';
          actividad2Div.style.display = 'none';
        } else {
          actividad1Div.style.display = 'none';
          actividad2Div.style.display = 'block';
          estadoAct2 = { ...escenarios[escenarioActual] };
          renderActividad2();
        }
      });
    });

    // Cambio de subactividades (A, B, C)
    subnivelBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const esc = btn.getAttribute('data-escenario');
        cambiarEscenario(esc);
      });
    });

    // Dibujar fracci√≥n de respuesta del estudiante
    function dibujarFraccionRespuesta(n, d) {
      pizzasRespuesta.innerHTML = "";
      if (d <= 0 || n < 0) return;

      const completas = Math.floor(n / d);
      const resto = n % d;
      const totalPizzas = completas + (resto > 0 ? 1 : 0);
      if (totalPizzas === 0) return;

      for (let i = 0; i < totalPizzas; i++) {
        const card = document.createElement('div');
        card.className = 'pizza-respuesta-card';
        const svgWrap = document.createElement('div');
        svgWrap.className = 'pizza-respuesta-svg';

        const trozos = (i < completas) ? d : resto;
        svgWrap.appendChild(crearPizzaConSalame(trozos, d));
        card.appendChild(svgWrap);
        pizzasRespuesta.appendChild(card);
      }
    }

    // Verificar respuesta
    btnVerificar.addEventListener('click', () => {
      const nResp = parseInt(respNum.value, 10);
      const dResp = parseInt(respDen.value, 10);

      pizzasRespuesta.innerHTML = "";
      feedbackRespuesta.textContent = "";
      feedbackRespuesta.className = "nota-pequena";
      mensajeDiv.style.display = 'none';
      mensajeTextoDiv.textContent = "";

      if (isNaN(nResp) || isNaN(dResp) || dResp <= 0 || nResp < 0) {
        feedbackRespuesta.textContent = "Escribe una fracci√≥n v√°lida.";
        feedbackRespuesta.classList.add('respuesta-mal');
        return;
      }

      dibujarFraccionRespuesta(nResp, dResp);

      const { num: numCorrecto, den: denCorrecto } = sumaActualSimplificada();

      if (nResp * denCorrecto === dResp * numCorrecto) {
        // Correcto
        feedbackRespuesta.textContent = "‚úî Bien hecho: tu fracci√≥n representa correctamente la pizza que qued√≥ en total.";
        feedbackRespuesta.classList.add('respuesta-bien');

        mensajeDiv.style.display = 'block';
        mensajeDiv.classList.add('ok');
        mensajeTextoDiv.innerHTML = `
          Has encontrado una fracci√≥n equivalente a la suma de las sobras de Luna y Max.<br>
          Suma simplificada: <strong>${numCorrecto}/${denCorrecto}</strong>.
        `;

        // Ocultar herramientas de corte
        btnCortarLuna.style.display = 'none';
        btnCortarMax.style.display = 'none';
        panelCorteLuna.style.display = 'none';
        panelCorteMax.style.display = 'none';
        btnResetLuna.style.display = 'none';
        btnResetMax.style.display = 'none';
      } else {
        // Incorrecto
        feedbackRespuesta.textContent =
          "‚ùå Esa fracci√≥n no corresponde a la cantidad de pizza que qued√≥.";
        feedbackRespuesta.classList.add('respuesta-mal');

        mensajeDiv.style.display = 'block';
        mensajeDiv.classList.remove('ok');
        mensajeTextoDiv.innerHTML = `
          Revisa tu fracci√≥n y observa las pizzas.<br>
          Si lo necesitas, prueba a cortar la pizza de Luna o la de Max para ver mejor las porciones.
        `;

        // Mostrar solo los botones de cortar; el de volver aparece reci√©n tras un corte
        btnCortarLuna.style.display = 'inline-flex';
        btnCortarMax.style.display = 'inline-flex';
      }
    });

    // Mostrar panel de corte debajo de cada pizza
    btnCortarLuna.addEventListener('click', () => {
      panelCorteLuna.style.display = 'block';
      mensajeCorteLuna.textContent = "";
      inputFactorLuna.value = "";
      panelCorteMax.style.display = 'none';
      mensajeCorteMax.textContent = "";
    });

    btnCortarMax.addEventListener('click', () => {
      panelCorteMax.style.display = 'block';
      mensajeCorteMax.textContent = "";
      inputFactorMax.value = "";
      panelCorteLuna.style.display = 'none';
      mensajeCorteLuna.textContent = "";
    });

    // Aplicar corte Luna
    btnAplicarCorteLuna.addEventListener('click', () => {
      const factor = parseInt(inputFactorLuna.value, 10);
      if (isNaN(factor) || factor < 1) {
        mensajeCorteLuna.textContent = "Escribe un n√∫mero de partes mayor o igual que 1.";
        return;
      }
      if (factor > 10) {
        mensajeCorteLuna.textContent = "Usa un n√∫mero de partes razonable (por ejemplo, de 1 a 10).";
        return;
      }

      estadoAct2.n1 *= factor;
      estadoAct2.d1 *= factor;
      mensajeCorteLuna.textContent = "";
      dibujarPizzaAct2();

      // Ahora s√≠ tiene sentido ofrecer "Volver al corte original"
      btnResetLuna.style.display = 'inline-flex';
    });

    // Aplicar corte Max
    btnAplicarCorteMax.addEventListener('click', () => {
      const factor = parseInt(inputFactorMax.value, 10);
      if (isNaN(factor) || factor < 1) {
        mensajeCorteMax.textContent = "Escribe un n√∫mero de partes mayor o igual que 1.";
        return;
      }
      if (factor > 10) {
        mensajeCorteMax.textContent = "Usa un n√∫mero de partes razonable (por ejemplo, de 1 a 10).";
        return;
      }

      estadoAct2.n2 *= factor;
      estadoAct2.d2 *= factor;
      mensajeCorteMax.textContent = "";
      dibujarPizzaAct2();

      // Mostrar "Volver al corte original" para Max
      btnResetMax.style.display = 'inline-flex';
    });

    // Volver al corte original de Luna
    btnResetLuna.addEventListener('click', () => {
      const esc = escenarios[escenarioActual];
      estadoAct2.n1 = esc.n1;
      estadoAct2.d1 = esc.d1;
      panelCorteLuna.style.display = 'none';
      mensajeCorteLuna.textContent = "";
      inputFactorLuna.value = "";
      dibujarPizzaAct2();
      // Despu√©s de volver, podemos ocultar el bot√≥n hasta que vuelva a cortar
      btnResetLuna.style.display = 'none';
    });

    // Volver al corte original de Max
    btnResetMax.addEventListener('click', () => {
      const esc = escenarios[escenarioActual];
      estadoAct2.n2 = esc.n2;
      estadoAct2.d2 = esc.d2;
      panelCorteMax.style.display = 'none';
      mensajeCorteMax.textContent = "";
      inputFactorMax.value = "";
      dibujarPizzaAct2();
      btnResetMax.style.display = 'none';
    });

    // Inicializar
    dibujarActividad1(); // Actividad 1 al cargar
    // Actividad 2 se prepara al entrar en su pesta√±a
  </script>
</body>
</html>
        
